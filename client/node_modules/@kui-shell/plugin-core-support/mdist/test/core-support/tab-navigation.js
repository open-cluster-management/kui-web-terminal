var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { Common, CLI, Keys, Selectors } from '@kui-shell/test';
import { tabButtonSelector } from '../../lib/new-tab';
describe('tab navigation', function () {
    before(Common.before(this));
    after(Common.after(this));
    const testPromptIsSelected = (hitTab = false, waitForSessionInit = false) => {
        it('should focus on repl input since we just hit Enter', () => __awaiter(this, void 0, void 0, function* () {
            try {
                if (waitForSessionInit) {
                    yield CLI.waitForSession(this);
                }
                if (hitTab) {
                    yield this.app.client.keys(Keys.TAB);
                }
                yield this.app.client.waitForEnabled(Selectors.CURRENT_PROMPT_BLOCK);
            }
            catch (err) {
                yield Common.oops(this)(err);
            }
        }));
    };
    const waitForFocus = (selector) => {
        return this.app.client.waitUntil(() => __awaiter(this, void 0, void 0, function* () {
            try {
                return this.app.client.hasFocus(selector);
            }
            catch (err) {
                console.error(err);
                throw err;
            }
        }), 20000);
    };
    const testSelector = (selector, hitEnter = false, selectedSelector) => {
        it(`should tab to the ${selector} hitEnter=${hitEnter}`, () => __awaiter(this, void 0, void 0, function* () {
            try {
                yield this.app.client.keys(Keys.TAB);
                yield waitForFocus(selector);
                if (hitEnter) {
                    yield this.app.client.keys(Keys.ENTER);
                    yield this.app.client.waitForEnabled(selectedSelector);
                }
            }
            catch (err) {
                yield Common.oops(this)(err);
            }
        }));
    };
    const testAboutMode = (mode, hitEnter = false) => {
        testSelector(`${Selectors.SIDECAR_MODE_BUTTON(mode)} .kui--tab-navigatable`, hitEnter, Selectors.SIDECAR_MODE_BUTTON_SELECTED(mode));
    };
    const testNoTabNavigation = () => {
        it('should still focus on repl input if we hit tab while the input has content', () => __awaiter(this, void 0, void 0, function* () {
            try {
                const { count } = yield CLI.command(' ', this.app, true, false, true);
                yield this.app.client.keys(Keys.TAB);
                yield this.app.client.waitForEnabled(Selectors.PROMPT_N(count));
            }
            catch (err) {
                yield Common.oops(this)(err);
            }
        }));
    };
    const hitBackspace = () => {
        it('should hit the backspace key once, to clear the repl input', () => {
            return this.app.client.keys(Keys.BACKSPACE);
        });
    };
    const TAB_BUTTON_N = (N) => `.kui-tab:nth-child(${N})`;
    const testFullCycle = () => {
        testSelector(TAB_BUTTON_N(1));
        testSelector(TAB_BUTTON_N(2));
        testSelector(tabButtonSelector);
        testSelector('#help-button');
        testPromptIsSelected(true);
        it('should be the end of the full cycle', () => true);
    };
    testPromptIsSelected(false, true);
    testNoTabNavigation();
    hitBackspace();
    testSelector(TAB_BUTTON_N(1));
    testSelector(tabButtonSelector, true, Selectors.TAB_SELECTED_N(2));
    testPromptIsSelected(false, true);
    testFullCycle();
    testFullCycle();
    testFullCycle();
    testSelector(TAB_BUTTON_N(1));
    testSelector(TAB_BUTTON_N(2));
    testSelector(tabButtonSelector);
    testSelector('#help-button', true, Selectors.SIDECAR_MODE_BUTTON_SELECTED('about'));
    testPromptIsSelected();
    testSelector(TAB_BUTTON_N(1));
    testSelector(TAB_BUTTON_N(2));
    testSelector(tabButtonSelector);
    testSelector('#help-button');
    testAboutMode('about');
    testAboutMode('gettingStarted');
    testAboutMode('configure');
    testAboutMode('version', true);
    testPromptIsSelected();
});
//# sourceMappingURL=tab-navigation.js.map