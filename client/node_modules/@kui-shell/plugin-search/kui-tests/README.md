# mcm-kui-tests
[![Build Status](https://travis-ci.com/open-cluster-management/mcm-kui-tests.svg?token=QyqNARqbMTFfLxWqTpsi&branch=master)](https://travis-ci.com/open-cluster-management/mcm-kui-tests)

The test automation repository for IBM Cloud Pak Foundation - [Visual Web Terminal](https://github.com/open-cluster-management/kui-web-terminal); also referred to as [KUI](https://github.com/IBM/kui).

## How to run Nightwatch tests

#### Prerequisites:

- Install Nightwatch globally:  `npm install -g nightwatch`

---

#### Live Cluster

1. Export the following environment variables:
    - K8S_CLUSTER_MASTER_IP (e.g. `icp-console.apps.ocp4-testing-04-cs.yellow-chesterfield.com` or `9.9.9.9:8443`)
    - K8S_CLUSTER_USER (`login username`)
    - K8S_CLUSTER_PASSWORD (`login password`)
2. In the root directory, run `make setup-dependencies`.
3. In the root directory, run `make run-all-tests`.

#### Local Environment

1. Pull the latest integration image:  `hyc-cloud-private-integration-docker-local.artifactory.swg-devops.com/ibmcom/mcm-kui-proxy-amd64:latest`
2. Export the following environment variables:
    - K8S_CLUSTER_MASTER_IP (e.g. `icp-console.apps.ocp4-testing-04-cs.yellow-chesterfield.com` or `9.9.9.9:8443`)
    - K8S_CLUSTER_USER (`login username`)
    - K8S_CLUSTER_PASSWORD (`login password`)
    - TEST_LOCAL=true
3. In the root directory, run `make run`.  A KUI docker container will start.
4. In the root directory, run `make setup-dependencies`.
5. In the root directory, run `make run-all-tests`.

#### Browser Specific Testing

In the previous instructions; replace the command for `make run-all-tests` with any of the following:
  - Firefox:  `make run-all-tests` (Default)
  - Chrome:  `make run-all-tests BROWSER=chrome`
  - Safari:  `make run-all-tests BROWSER=safari`
  - Edge:  Not supported
  - Firefox Headless:  `make run-all-tests TEST_POSTFIX=.headless`
  - Chrome Headless: `make run-all-tests BROWSER=chrome TEST_POSTFIX=.headless`

## Writing Tests

This test automation repository is powered by [Nightwatch.js](https://nightwatchjs.org/), a selenium based browser functional testing framework.

All test files and configurations are housed under `/tests`.  Routine and ordinary test suites should be placed in the `/e2e` subdirectory; any Nightwatch tests cases used for other purposes should be placed in an appropriate separate subdirectory.


#### Ensuring Test Cases Support All Browsers

Various Nightwatch API commands will be broken when run against non-Chromium based browsers.  See the following:

| Nightwatch Command                      | Use                                     | API                                     |
| --------------------------------------- | --------------------------------------- | --------------------------------------- |
| `waitForElementVisible`                 | `waitForElementPresent`                 | [Nightwatch Elements](https://nightwatchjs.org/api/commands/#elements-headline)                                |
| `waitForElementNotVisible`              | `waitForElementNotPresent`              | [Nightwatch Elements](https://nightwatchjs.org/api/commands/#elements-headline)                                 |
| `keys`                                  | `setValue(<Key object>)`                | [Nightwatch Element Interaction](https://nightwatchjs.org/api/commands/#setValue)                                |
| `click`                                 | `press`                                 | [Custom Command](https://github.com/open-cluster-management/mcm-kui-tests/blob/master/tests/commands/press.js)                                  |
| `setValue(ENTER)/keys(ENTER)`                                 | `enter`                                 | [Custom Command](https://github.com/open-cluster-management/mcm-kui-tests/blob/master/tests/commands/enter.js)                                  |

## Accessibility Scan Automation

This test automation repository uses the `@ibma/aat` npm module to run DAP scan automation.

1. Export the following environment variables (Use the mcmdev@us.ibm.com credentials from: https://ibm.ent.box.com/notes/287638278960):
    - NPM_USER
    - NPM_PWD
2. Follow the previous instructions for [How to Run Nightwatch Tests](https://github.com/open-cluster-management/mcm-kui-tests#how-to-run-nightwatch-tests); but do not run the `make run-all-tests` step.
3. In the root repository, run `make install-aat`.
4. In the root repository, run `make a11y-scan A11Y_SCAN=true`.
5. [Optional] To generate an automated csv report based on the scan results; run `make a11y-report`.  The report will be available in `./test-output/a11y/a11y-report.csv`.

## Daily Build

This test automation repository supports a daily build that runs in [Travis CI](https://travis-ci.com/open-cluster-management/mcm-kui-tests).  The following builds are currently supported:

- Vulnerability Advisor scan for the amd64, ppc64le, and s390x integration images.
- Accessibility scan automation

## Notes

- Accept SSL certificate configuration for Safari is broken, when running tests locally, first visit the target environment and accept the certificates manually.
