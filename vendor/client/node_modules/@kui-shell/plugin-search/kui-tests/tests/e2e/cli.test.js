/*******************************************************************************
 * Licensed Materials - Property of IBM
 * (c) Copyright IBM Corporation 2019. All Rights Reserved.
 *
 * Note to U.S. Government Users Restricted Rights:
 * Use, duplication or disclosure restricted by GSA ADP Schedule
 * Contract with IBM Corp.
 *******************************************************************************/

module.exports = {
  before: function (browser) {
    const KUI =  browser.page.KUI()
    const loginPage = browser.page.LoginPage()
    if (!process.env.TEST_LOCAL) {
      loginPage.navigate()
      loginPage.authenticate()
    }
    KUI.navigate()
    KUI.waitForPageLoad(browser)
    KUI.verifyWebsocketConnection(browser)
  },

  'Verify supported CLIs can execute': browser => {
    const KUI = browser.page.KUI()
    const supportedClis = ['kubectl help', 'oc', 'helm create mychart', 'cloudctl']
    supportedClis.forEach(cli => {
      KUI.executeCommand(browser, cli)
      KUI.verifyOutputSuccess(browser)
    })
  },

  'Verify kubectl': browser => {
    const KUI = browser.page.KUI()
    const CLI = browser.page.CLI()
    const commands = ['get secrets', 'get deployments'] 
    commands.forEach(command => {
      KUI.executeCommand(browser, `kubectl ${command} -n openshift-console`)
      CLI.verifyTableOutput(browser)
      KUI.verifyDetailSidecar(browser)
    })
  },

  'Verify oc': browser => {
    const KUI = browser.page.KUI()
    const CLI = browser.page.CLI()
    KUI.executeCommand(browser, 'oc get pods -n openshift-console')
    CLI.verifyTableOutput(browser)
    KUI.verifyDetailSidecar(browser)
  },

  after: function (browser, done) {
    setTimeout(() => {
      if (browser.sessionId) {
        browser.end()
        done()
      } else {
        done()
      }
    })
  }
}
